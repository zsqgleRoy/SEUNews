import{r as d,k as z,m as J,I as Q,l as W,o as M,J as F,K as Y,j as X,M as Z,E as m,H as $,T as ee,_ as R,h as E,c as g,e as v,b as s,f as N,N as b,O as T,P as D,F as te,g as ae,t as oe,n as k,i as B,d as se,D as ne,Q as le}from"./index-CUMlhCnO.js";import{a as re,T as de,E as ie}from"./Upload-ZmpmZ8B4.js";import{b as ue,a as ce}from"./news-DBmEFlcx.js";const me={components:{Editor:ie,Toolbar:de,apiUploadHeadImage:re},props:{news:{type:Object,required:!0}},setup(h){const a=d(0),{news:_}=z(h),t=J(),u=d(_.value.title),n=new Date,i=d(""),p=d("DRAFT"),w=d(0),o=d(""),c=Q(null),y=d(),H=d(W.getUserCache()),U=d([]),C=d(1);M(async()=>{const e=F.generateCacheKey(),l=F.getCache(e);if(l)U.value=l.map(f=>({tag_id:f.tag_id,label:f.label}));else try{const f=await Y();U.value=f.data,F.saveCacheData(e,f.data,36e5)}catch{}const r=n.getFullYear(),I=String(n.getMonth()+1).padStart(2,"0"),S=String(n.getDate()).padStart(2,"0"),V=String(n.getHours()).padStart(2,"0"),q=String(n.getMinutes()).padStart(2,"0"),G=String(n.getSeconds()).padStart(2,"0"),j=`${r}-${I}-${S}T${V}:${q}:${G}`;i.value=j});const x={},A={placeholder:"输入内容...",MENU_CONF:{uploadImage:{maxFileSize:15*1024*1024,server:$.SERVER_URL+"/api/upload/newsImg",fieldName:"file",headers:{Authorization:"1"},maxNumberOfFiles:10,customInsert(e,l){var I,S;if(e.code!==200){console.error("上传失败:",e.msg);return}const r=(S=(I=e.data)==null?void 0:I.data)==null?void 0:S.url;r&&(l(r,"",""),m.success("添加正文图片成功！"))},onError(e,l,r){m.error("上传错误:"+l+r)}},fontFamily:{fontFamilyList:[{name:"仿宋_GB2312",value:"楷体_GB2312"},{name:"宋体",value:"SimSun"},"黑体","楷体","Arial","Tahoma","Verdana"],showCustom:!0},style:{fontFamily:"楷体_GB2312"}}};X(()=>h.news,e=>{e&&(u.value=e.title,p.value=e.status,y.value=e.content,o.value=e.headImageUrl,C.value=e.tag||1,a.value=e.id||0,ee(()=>{c.value&&e.content!==c.value.getHtml()&&c.value.setHtml(e.content)}))},{deep:!0,immediate:!0});const L=e=>{o.value=e,w.value+=1},O=e=>{e?(o.value=e,m.success("封面缓存成功！")):m.error("封面缓存失败！")},P=async()=>{var l;if((l=H.value)!=null&&l.username){if(!(u.value&&i.value&&p.value&&o.value&&y.value&&C.value)){m.error("新闻信息不完整，请您重试！");return}}else{m.warning("非法操作，你不是管理员！");return}const e={id:a.value,title:u.value,updateDate:i.value,content:y.value,status:p.value,tag:C.value,headImageUrl:o.value};try{const r=await ue(e);m.success(r==null?void 0:r.data),t.go(-1)}catch(r){console.error("保存新闻时出错:",r)}},K=()=>{if(c.value){try{c.value.destroy();const e=document.querySelector(".editor-content");e&&e.parentNode&&e.parentNode.removeChild(e)}catch(e){console.error("编辑器销毁错误:",e)}c.value=null}};return Z(()=>{K(),document.querySelectorAll(".w-e-toolbar").forEach(l=>{l.parentNode&&l.parentNode.removeChild(l)})}),{newsTitle:u,newsTime:i,editorRef:c,articleStatus:p,valueHtml:y,mode:"default",toolbarConfig:x,editorConfig:A,headImgUrl:o,newsId:a,handleCreated:e=>{c.value=e},updateNews:P,reviewParam:O,handleHeadImageUpdate:L,menuItems:U,selectedMenu:C,componentKey:w}}},ve={class:"editor-container"},pe={class:"input-row"},fe={class:"input-group"},ge={class:"form-item"},he={class:"form-item"},_e={class:"form-item"},we={class:"select-group"},ye=["value"],Ce={class:"form-item"},Ie={key:0,class:"button-group"},Se={class:"editor-wrapper"};function be(h,a,_,t,u,n){const i=E("apiUploadHeadImage"),p=E("Toolbar"),w=E("Editor");return v(),g("div",ve,[a[7]||(a[7]=s("div",{class:"add-news-header"},[s("h1",null,"修改新闻")],-1)),s("div",pe,[s("div",fe,[s("div",ge,[b(s("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>t.newsTitle=o),placeholder:"请输入新闻标题",class:"news-title-input"},null,512),[[T,t.newsTitle]])]),s("div",he,[b(s("input",{type:"datetime-local","onUpdate:modelValue":a[1]||(a[1]=o=>t.newsTime=o),step:"1",class:"news-time-input"},null,512),[[T,t.newsTime]])]),s("div",_e,[s("div",we,[b(s("select",{"onUpdate:modelValue":a[2]||(a[2]=o=>t.articleStatus=o),class:"status-select"},a[6]||(a[6]=[s("option",{value:"DRAFT"},"草稿",-1),s("option",{value:"PUBLISHED"},"已发布",-1)]),512),[[D,t.articleStatus]]),b(s("select",{"onUpdate:modelValue":a[3]||(a[3]=o=>t.selectedMenu=o),class:"menu-select"},[(v(!0),g(te,null,ae(t.menuItems,o=>(v(),g("option",{key:o.tag_id,value:o.tag_id},oe(o.label),9,ye))),128))],512),[[D,t.selectedMenu]])])]),s("div",Ce,[s("button",{class:"button-submit",onClick:a[4]||(a[4]=(...o)=>t.updateNews&&t.updateNews(...o))},"保存新闻")])]),t.headImgUrl?(v(),g("div",Ie,[(v(),k(i,{onSendParam:t.reviewParam,headImageUrl:t.headImgUrl,key:t.componentKey},null,8,["onSendParam","headImageUrl"]))])):N("",!0)]),s("div",Se,[B(p,{style:{"border-bottom":"1px solid #e0e0e0"},editor:t.editorRef,defaultConfig:t.toolbarConfig,mode:t.mode},null,8,["editor","defaultConfig","mode"]),B(w,{style:{height:"500px","overflow-y":"auto"},modelValue:t.valueHtml,"onUpdate:modelValue":a[5]||(a[5]=o=>t.valueHtml=o),defaultConfig:t.editorConfig,mode:t.mode,onOnCreated:t.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])])}const Ue=R(me,[["render",be],["__scopeId","data-v-85d2bfb6"]]),Fe={class:"editor-container"},Ee={key:0,class:"top-menu"},Ne=se({__name:"EditNews",setup(h){const a=ne(),_=d(window.innerWidth<768),t=d({id:0,title:"",publishDate:"",updateDate:"",content:"",author:"",status:"DRAFT",tag:0,headImageUrl:""}),u=Number(a.params.id);return M(async()=>{try{const n=await ce(u);t.value=n==null?void 0:n.data,t.value.id=u}catch{m.error("获取新闻详情失败，请稍后重试！")}}),(n,i)=>(v(),g("div",Fe,[_.value?(v(),g("div",Ee,[B(le),i[0]||(i[0]=s("h1",null,"修改新闻",-1))])):N("",!0),t.value?(v(),k(Ue,{key:1,news:t.value},null,8,["news"])):N("",!0)]))}}),Re=R(Ne,[["__scopeId","data-v-39158431"]]);export{Re as default};
