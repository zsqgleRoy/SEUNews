import{m as A,r,I as k,l as P,o as L,J as y,K as O,M as K,E as f,H as q,_ as I,h as N,c as g,e as _,b as s,N as b,O as B,P as E,F as z,g as J,t as Q,i as h,d as W,f as Y,Q as j}from"./index-CUMlhCnO.js";import{a as G,T as X,E as Z}from"./Upload-ZmpmZ8B4.js";import{p as $}from"./news-DBmEFlcx.js";const ee={components:{Editor:Z,Toolbar:X,apiUploadHeadImage:G},setup(){A();const m=r(""),t=new Date,d=r(""),e=r("DRAFT"),w=r(),i=k(null),v=r(),C=r(P.getUserCache()),p=r([]),a=r(1);L(async()=>{const o=y.generateCacheKey(),n=y.getCache(o);if(n)p.value=n.map(c=>({tag_id:c.tag_id,label:c.label}));else try{const c=await O();p.value=c.data,y.saveCacheData(o,c.data,36e5)}catch{}const l=t.getFullYear(),u=String(t.getMonth()+1).padStart(2,"0"),S=String(t.getDate()).padStart(2,"0"),V=String(t.getHours()).padStart(2,"0"),R=String(t.getMinutes()).padStart(2,"0"),H=String(t.getSeconds()).padStart(2,"0"),x=`${l}-${u}-${S}T${V}:${R}:${H}`;d.value=x});const U={},D={placeholder:"输入内容...",MENU_CONF:{uploadImage:{server:q.SERVER_URL+"/api/upload/newsImg",fieldName:"file",headers:{Authorization:"1"},customInsert(o,n){var u,S;if(o.code!==200){console.error("上传失败:",o.msg);return}const l=(S=(u=o.data)==null?void 0:u.data)==null?void 0:S.url;l&&(n(l,"",""),f.success("添加正文图片成功！"))},onError(o,n,l){f.error("上传错误:"+n+l)}}}},F=o=>{o?(w.value=o,f.success("封面缓存成功！")):f.error("封面缓存失败！")},T=async()=>{var n,l;if(!(m.value&&((n=C.value)!=null&&n.username)&&d.value&&e.value&&w.value&&v.value&&a.value)){f.error("新闻信息不完整，请您重试！");return}const o={title:m.value,publishDate:d.value,updateDate:d.value,content:v.value,author:(l=C.value)==null?void 0:l.username,status:e.value,tag:a.value,headImageUrl:w.value};try{await $(o)}catch(u){console.error("保存新闻时出错:",u)}},M=()=>{if(i.value){try{i.value.destroy();const o=document.querySelector(".editor-content");o&&o.parentNode&&o.parentNode.removeChild(o)}catch(o){console.error("编辑器销毁错误:",o)}i.value=null}};return K(()=>{M(),document.querySelectorAll(".w-e-toolbar").forEach(n=>{n.parentNode&&n.parentNode.removeChild(n)})}),{newsTitle:m,newsTime:d,editorRef:i,articleStatus:e,valueHtml:v,mode:"default",toolbarConfig:U,editorConfig:D,handleCreated:o=>{i.value=o},saveNews:T,reviewParam:F,menuItems:p,selectedMenu:a}}},te={class:"editor-container"},oe={class:"input-row"},ae={class:"input-group"},se={class:"form-item"},ne={class:"form-item"},le={class:"form-item"},re={class:"select-group"},de=["value"],ie={class:"form-item"},ue={class:"button-group"},ce={class:"editor-wrapper"};function me(m,t,d,e,w,i){const v=N("apiUploadHeadImage"),C=N("Toolbar"),p=N("Editor");return _(),g("div",te,[t[7]||(t[7]=s("div",{class:"add-news-header"},[s("h1",null,"添加新闻")],-1)),s("div",oe,[s("div",ae,[s("div",se,[b(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>e.newsTitle=a),placeholder:"请输入新闻标题",class:"news-title-input"},null,512),[[B,e.newsTitle]])]),s("div",ne,[b(s("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=a=>e.newsTime=a),step:"1",class:"news-time-input"},null,512),[[B,e.newsTime]])]),s("div",le,[s("div",re,[b(s("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>e.articleStatus=a),class:"status-select"},t[6]||(t[6]=[s("option",{value:"DRAFT"},"草稿",-1),s("option",{value:"PUBLISHED"},"已发布",-1)]),512),[[E,e.articleStatus]]),b(s("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>e.selectedMenu=a),class:"menu-select"},[(_(!0),g(z,null,J(e.menuItems,a=>(_(),g("option",{key:a.tag_id,value:a.tag_id},Q(a.label),9,de))),128))],512),[[E,e.selectedMenu]])])]),s("div",ie,[s("button",{class:"button-submit",onClick:t[4]||(t[4]=(...a)=>e.saveNews&&e.saveNews(...a))},"保存新闻")])]),s("div",ue,[h(v,{onSendParam:e.reviewParam},null,8,["onSendParam"])])]),s("div",ce,[h(C,{style:{"border-bottom":"1px solid #e0e0e0"},editor:e.editorRef,defaultConfig:e.toolbarConfig,mode:e.mode},null,8,["editor","defaultConfig","mode"]),h(p,{style:{height:"500px","overflow-y":"auto"},modelValue:e.valueHtml,"onUpdate:modelValue":t[5]||(t[5]=a=>e.valueHtml=a),defaultConfig:e.editorConfig,mode:e.mode,onOnCreated:e.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])])}const ve=I(ee,[["render",me],["__scopeId","data-v-2ae9d75f"]]),pe={class:"editor-container"},fe={key:0,class:"top-menu"},ge=W({__name:"AddNews",setup(m){const t=r(window.innerWidth<768);return(d,e)=>(_(),g("div",pe,[t.value?(_(),g("div",fe,[h(j),e[0]||(e[0]=s("h1",null,"添加新闻",-1))])):Y("",!0),h(ve)]))}}),Se=I(ge,[["__scopeId","data-v-b69f09b0"]]);export{Se as default};
